<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Superhero Tic Tac Toe ‚Äî VS Computer</title>
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#ffe5ec; --bg2:#c3f0f2; --accent:#ff6b6b; --accent2:#1dd1a1;
  }
  *{box-sizing:border-box}
  body{
    font-family:'Comic Neue', cursive;
    margin:0;
    padding:28px;
    text-align:center;
    background: radial-gradient(circle at top left, var(--bg1), var(--bg2), #fef3c7);
    background-size:300% 300%;
    animation:bgAnim 20s linear infinite;
    color:#222;
  }
  @keyframes bgAnim{0%{background-position:0% 0%}50%{background-position:100% 100%}100%{background-position:0% 0%}}

  h1{font-size:2.8rem;margin:0 0 14px;color:var(--accent);text-shadow:1px 1px 8px rgba(0,0,0,0.2)}
  .controls{
    margin:14px auto 18px;
    display:flex;
    gap:10px;
    justify-content:center;
    align-items:center;
    flex-wrap:wrap;
  }
  input[type="text"]{
    padding:10px 12px;border-radius:12px;border:2px solid var(--accent2);font-size:1rem;outline:none;
  }
  select, button{padding:10px 14px;border-radius:12px;border:none;background:linear-gradient(135deg,#00d2ff,#3a7bd5);color:white;font-weight:700;cursor:pointer}
  select{background:linear-gradient(135deg,#f6d365,#fda085);color:#222}

  /* Huge turn display */
  .turnWrap{
    display:flex;
    gap:18px;
    justify-content:center;
    align-items:center;
    margin-bottom:18px;
  }
  #turnDisplay{
    font-size:2rem;
    font-weight:900;
    padding:10px 20px;
    border-radius:22px;
    background:linear-gradient(180deg,#ffffffcc,#ffffff99);
    box-shadow:0 8px 20px rgba(0,0,0,0.15);
    color:#2e86de;
    text-shadow:0 0 8px #a29bfe;
    min-width:300px;
    transform-origin:center;
    transition:transform .25s ease;
  }

  /* Superhero icons */
  .hero{
    font-size:2.2rem;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    width:100px;
  }
  .hero .icon{
    font-size:3rem;
    transition:transform .25s ease, filter .25s ease;
    transform-origin:center;
  }
  .activeHero .icon{transform:translateY(-6px) scale(1.18) rotate(-6deg); filter:drop-shadow(0 8px 12px rgba(0,0,0,0.25))}
  .heroLabel{font-size:.85rem;color:#333}

  /* Board */
  #board{
    display:grid;
    grid-template-columns:repeat(3,120px);
    grid-template-rows:repeat(3,120px);
    gap:12px;
    justify-content:center;
    margin:12px auto 20px;
  }
  .cell{
    background:linear-gradient(145deg,#ffeaa7,#fab1a0);
    border-radius:16px;
    font-size:3.2rem;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    box-shadow:0 10px 22px rgba(0,0,0,0.15);
    border:3px solid rgba(0,0,0,0.06);
    transition:transform .15s ease, background .2s;
    user-select:none;
  }
  .cell:hover{transform:scale(1.06) rotate(2deg)}
  .cell.disabled{cursor:default;opacity:.85}

  /* smaller board for mobile */
  @media (max-width:540px){
    #board{grid-template-columns:repeat(3,86px);grid-template-rows:repeat(3,86px)}
    .cell{font-size:2.2rem;border-radius:12px}
    #turnDisplay{min-width:220px;font-size:1.5rem}
  }

  /* victory overlay */
  #victoryOverlay{
    display:none;
    position:fixed;left:0;top:0;width:100%;height:100%;
    background:rgba(0,0,0,0.45);
    z-index:9999;
    backdrop-filter:blur(6px);
    align-items:center;justify-content:center;
  }
  #victoryCard{
    position:relative;
    width:86%;
    max-width:900px;
    padding:28px;
    border-radius:20px;
    background:linear-gradient(180deg,#ffffffcc,#ffffffaa);
    box-shadow:0 18px 60px rgba(0,0,0,0.4);
    text-align:center;
  }
  #victoryText{
    font-size:3.4rem;
    font-weight:900;
    color:#fff;
    text-shadow:0 0 22px #ff6b6b, 0 0 36px #ffd166;
    margin:6px 0 12px;
  }
  #subText{font-size:1.4rem;color:#fff;margin-bottom:12px;text-shadow:0 0 14px rgba(0,0,0,0.25)}
  #victoryHeroes{font-size:6rem;margin:6px 0 10px;display:flex;gap:18px;justify-content:center;align-items:center}
  .heroPose{transform:translateY(0);transition:transform .6s ease}
  .heroPose.win{transform:translateY(-10px) scale(1.18) rotate(-6deg)}

  #overlayButtons{margin-top:14px;display:flex;gap:12px;justify-content:center}

  /* small helper text */
  .hint{font-size:.9rem;color:#333;margin-top:8px}

  /* confetti canvas full screen */
  #confettiCanvas{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none}

  /* very small footer */
  footer{margin-top:18px;color:#666;font-size:.85rem}

  /* TIME LIMIT POPUP STYLES */
  #timePopup{
    display:none;
    position:fixed;
    left:0; top:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.6);
    backdrop-filter:blur(6px);
    z-index:99999;
    align-items:center; justify-content:center;
  }
  #timePopup div{
    background:white;
    padding:28px;
    border-radius:18px;
    box-shadow:0 8px 20px rgba(0,0,0,0.25);
    font-size:1.5rem;
    font-weight:700;
    text-align:center;
  }
</style>
</head>
<body>

<h1>ü¶∏ Superhero Tic Tac Toe ‚Äî VS Computer</h1>

<div class="controls">
  <input id="playerName" type="text" placeholder="Enter your name (e.g., Arya)" value="Hero Player" />
  <label title="Choose difficulty" style="display:flex;align-items:center;gap:8px">
    <select id="difficulty" aria-label="difficulty">
      <option value="easy">Easy ‚Äî Friendly Bot</option>
      <option value="hard" selected>Hard ‚Äî Smart Bot</option>
    </select>
  </label>
  <button id="startBtn">Start Game</button>
  <button id="resetAllBtn" style="background:linear-gradient(135deg,#ff9a9e,#fecfef);color:#222">Reset</button>
</div>

<div class="turnWrap" aria-hidden="false">
  <div id="playerHero" class="hero">
    <div id="playerIcon" class="icon">ü¶∏‚Äç‚ôÇÔ∏è</div>
    <div class="heroLabel" id="playerLabel">You</div>
  </div>

  <div id="turnDisplay">Press Start to Play</div>

  <div id="aiHero" class="hero">
    <div id="aiIcon" class="icon">ü¶π‚Äç‚ôÄÔ∏è</div>
    <div class="heroLabel" id="aiLabel">Computer</div>
  </div>
</div>

<div id="board" role="grid" aria-label="tic tac toe board">
  <div class="cell" data-index="0" role="button" aria-label="cell 0"></div>
  <div class="cell" data-index="1" role="button" aria-label="cell 1"></div>
  <div class="cell" data-index="2" role="button" aria-label="cell 2"></div>
  <div class="cell" data-index="3" role="button" aria-label="cell 3"></div>
  <div class="cell" data-index="4" role="button" aria-label="cell 4"></div>
  <div class="cell" data-index="5" role="button" aria-label="cell 5"></div>
  <div class="cell" data-index="6" role="button" aria-label="cell 6"></div>
  <div class="cell" data-index="7" role="button" aria-label="cell 7"></div>
  <div class="cell" data-index="8" role="button" aria-label="cell 8"></div>
</div>

<div style="display:flex;gap:12px;justify-content:center;align-items:center;flex-wrap:wrap">
  <button id="retryBtn" style="background:linear-gradient(135deg,#7afcff,#6a9cff)">üîÅ Retry</button>
  <button id="backBtn" style="background:linear-gradient(135deg,#ffd89b,#19547b)">‚¨Ö Back to Kids Zone</button>
</div>

<div class="hint">Tip: Hard difficulty uses optimal play. Try to beat Easy first! ‚ú®</div>

<footer>Made for Kids ‚Äî Superhero Theme</footer>

<!-- Victory Overlay -->
<div id="victoryOverlay" aria-hidden="true">
  <canvas id="confettiCanvas"></canvas>
  <div id="victoryCard">
    <div id="victoryHeroes">
      <div id="victorHero" class="heroPose">ü¶∏‚Äç‚ôÇÔ∏è</div>
      <div id="victorTextWrap">
        <div id="victoryText">Victory!</div>
        <div id="subText">Amazing! </div>
      </div>
      <div id="otherHero" class="heroPose">ü¶π‚Äç‚ôÄÔ∏è</div>
    </div>
    <div id="overlayButtons">
      <button id="overlayRetry">Play Again</button>
      <button id="overlayClose" style="background:linear-gradient(135deg,#ffa69e,#861657)">Close</button>
    </div>
  </div>
</div>

<!-- TIME LIMIT POPUP -->
<div id="timePopup">
  <div>‚è∞ You have reached your time, shutting the game‚Ä¶</div>
</div>

<script>
/* ====== Game Logic ====== */
const startBtn = document.getElementById('startBtn');
const resetAllBtn = document.getElementById('resetAllBtn');
const retryBtn = document.getElementById('retryBtn');
const backBtn = document.getElementById('backBtn');
const overlayRetry = document.getElementById('overlayRetry');
const overlayClose = document.getElementById('overlayClose');

const playerNameInput = document.getElementById('playerName');
const difficultySelect = document.getElementById('difficulty');

const turnDisplay = document.getElementById('turnDisplay');
const playerHero = document.getElementById('playerHero');
const aiHero = document.getElementById('aiHero');
const playerIcon = document.getElementById('playerIcon');
const aiIcon = document.getElementById('aiIcon');
const playerLabel = document.getElementById('playerLabel');
const aiLabel = document.getElementById('aiLabel');

const cells = Array.from(document.querySelectorAll('.cell'));
const victoryOverlay = document.getElementById('victoryOverlay');
const victoryText = document.getElementById('victoryText');
const subText = document.getElementById('subText');
const victorHero = document.getElementById('victorHero');
const otherHero = document.getElementById('otherHero');

const confettiCanvas = document.getElementById('confettiCanvas');

let board = Array(9).fill('');
let human = '‚ùå', ai = '‚≠ï'; // marks
let currentTurn = null; // 'human' or 'ai'
let gameOver = false;
let playerName = 'You';
let difficulty = 'hard'; // easy | hard

/* winning combos */
const winningCombos = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

/* helpers */
function setActiveHero(who){
  if(who==='human'){
    playerHero.classList.add('activeHero'); aiHero.classList.remove('activeHero');
    turnDisplay.innerText = `${playerName}'s Turn ‚Äî ${human}`;
    turnDisplay.style.transform = 'scale(1.03)';
    setTimeout(()=>turnDisplay.style.transform='scale(1)',200);
  } else {
    aiHero.classList.add('activeHero'); playerHero.classList.remove('activeHero');
    turnDisplay.innerText = `Computer's Turn ‚Äî ${ai}`;
    turnDisplay.style.transform = 'scale(1.03)';
    setTimeout(()=>turnDisplay.style.transform='scale(1)',200);
  }
}

/* start game */
startBtn.addEventListener('click', ()=> {
  playerName = playerNameInput.value.trim() || 'You';
  difficulty = difficultySelect.value;
  resetBoard();
  currentTurn = 'human'; // human starts
  setActiveHero('human');
  turnDisplay.innerText = `${playerName}'s Turn ‚Äî ${human}`;
});

/* reset everything */
resetAllBtn.addEventListener('click', ()=> {
  playerNameInput.value = 'Hero Player';
  difficultySelect.value = 'hard';
  playerName = 'You';
  difficulty = 'hard';
  resetBoard();
  turnDisplay.innerText = 'Press Start to Play';
  playerHero.classList.remove('activeHero'); aiHero.classList.remove('activeHero');
});

/* retry / play again buttons */
retryBtn.addEventListener('click', ()=> {
  resetBoard();
  currentTurn='human';
  setActiveHero('human');
});
overlayRetry.addEventListener('click', ()=> {
  hideVictory();
  resetBoard();
  currentTurn='human';
  setActiveHero('human');
});
overlayClose.addEventListener('click', ()=> {
  hideVictory();
});

backBtn.addEventListener('click', ()=> {
  window.location.href = 'kids.html';
});

/* reset board */
function resetBoard(){
  board = Array(9).fill('');
  gameOver = false;
  cells.forEach(c => { c.innerText=''; c.classList.remove('disabled'); });
  victoryOverlay.style.display='none';
  stopConfetti();
}

/* cell clicks for human */
cells.forEach(cell => {
  cell.addEventListener('click', ()=> {
    const idx = Number(cell.dataset.index);
    if(gameOver || board[idx]) return;
    if(currentTurn !== 'human') return;
    makeMove(idx, human);
    if(!gameOver){
      currentTurn = 'ai';
      setActiveHero('ai');
      // small delay for AI thinking
      setTimeout(() => aiPlay(), 450 + Math.random()*400);
    }
  });
});

/* make move and check win */
function makeMove(idx, mark){
  if(board[idx] || gameOver) return;
  board[idx] = mark;
  const c = cells[idx];
  c.innerText = mark;
  c.classList.add('disabled');
  checkGameState(mark);
}

/* check win or tie */
function checkGameState(mark){
  for(const combo of winningCombos){
    const [a,b,c] = combo;
    if(board[a] && board[a]===board[b] && board[a]===board[c]){
      gameOver = true;
      const winnerIsHuman = (board[a] === human);
      showVictory(winnerIsHuman ? 'You Win! üéâ' : 'Computer Wins!', winnerIsHuman);
      return;
    }
  }
  if(!board.includes('')){
    gameOver = true;
    showVictory("It's a Tie! ü§ù", null);
  }
}

/* AI play */
function aiPlay(){
  if(gameOver) return;
  let move;
  if(difficulty === 'easy'){
    const avail = board.map((v,i)=> v=== '' ? i : null).filter(v=> v!==null);
    move = avail[Math.floor(Math.random()*avail.length)];
  } else {
    move = bestMove(board, ai, human);
  }
  if(move !== undefined && move !== null){
    makeMove(move, ai);
    if(!gameOver){
      currentTurn = 'human';
      setActiveHero('human');
    }
  }
}

/* show victory overlay and confetti */
function showVictory(text, humanWon){
  victoryOverlay.style.display = 'flex';
  victoryOverlay.setAttribute('aria-hidden','false');

  victoryText.innerText = text;
  if(humanWon === true){
    subText.innerText = `Amazing! ${playerName} saved the day! ü¶∏‚Äç‚ôÇÔ∏è`;
    victorHero.innerText = 'ü¶∏‚Äç‚ôÇÔ∏è'; otherHero.innerText = 'ü¶π‚Äç‚ôÄÔ∏è';
    victorHero.classList.add('win'); otherHero.classList.remove('win');
  } else if(humanWon === false){
    subText.innerText = `Better luck next time ‚Äî computer wins this round.`;
    victorHero.innerText = 'ü¶π‚Äç‚ôÄÔ∏è'; otherHero.innerText = 'ü¶∏‚Äç‚ôÇÔ∏è';
    victorHero.classList.add('win'); otherHero.classList.remove('win');
  } else {
    subText.innerText = `It's a tie! ‚ö°`;
    victorHero.innerText = 'ü§ù'; otherHero.innerText = 'ü§ù';
    victorHero.classList.remove('win'); otherHero.classList.remove('win');
  }
  startConfetti();
}

function hideVictory(){
  victoryOverlay.style.display='none';
  victoryOverlay.setAttribute('aria-hidden','true');
  stopConfetti();
}

/* ==== Confetti === */
let confettiInterval;
function startConfetti(){
  const ctx = confettiCanvas.getContext('2d');
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
  const pieces = Array.from({length:150}).map(()=>{
    return {x:Math.random()*window.innerWidth, y:Math.random()*window.innerHeight, r:Math.random()*6+4, d:Math.random()*20+10, color:`hsl(${Math.random()*360},90%,60%)`, tilt:Math.random()*15-10};
  });
  confettiInterval = setInterval(()=>{
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    pieces.forEach(p=>{
      ctx.fillStyle=p.color;
      ctx.beginPath();
      ctx.moveTo(p.x+ p.tilt, p.y);
      ctx.lineTo(p.x + p.tilt + p.r/2, p.y + p.r);
      ctx.lineTo(p.x + p.tilt - p.r/2, p.y + p.r);
      ctx.closePath();
      ctx.fill();
      p.y += p.d/2;
      if(p.y>window.innerHeight) p.y = -10;
    });
  },33);
}
function stopConfetti(){clearInterval(confettiInterval);}

/* ==== Minimax AI for hard mode ==== */
function bestMove(board, aiMark, humanMark){
  let bestScore = -Infinity;
  let move;
  for(let i=0;i<board.length;i++){
    if(board[i]===''){
      board[i]=aiMark;
      let score = minimax(board,0,false,aiMark,humanMark);
      board[i]='';
      if(score>bestScore){bestScore=score; move=i;}
    }
  }
  return move;
}
function minimax(board,depth,isMax,aiMark,humanMark){
  if(checkWin(board,aiMark)) return 10-depth;
  if(checkWin(board,humanMark)) return depth-10;
  if(!board.includes('')) return 0;
  if(isMax){
    let best=-Infinity;
    for(let i=0;i<board.length;i++){
      if(board[i]===''){
        board[i]=aiMark;
        best=Math.max(best,minimax(board,depth+1,false,aiMark,humanMark));
        board[i]='';
      }
    }
    return best;
  } else {
    let best=Infinity;
    for(let i=0;i<board.length;i++){
      if(board[i]===''){
        board[i]=humanMark;
        best=Math.min(best,minimax(board,depth+1,true,aiMark,humanMark));
        board[i]='';
      }
    }
    return best;
  }
}
function checkWin(b,mark){
  return winningCombos.some(c=> c.every(i=>b[i]===mark));
}

/* ===== TIME-LIMIT POPUP ===== */
window.addEventListener("load", ()=>{
  // 3 minutes = 180000ms
  setTimeout(()=>{
    const popup = document.getElementById("timePopup");
    popup.style.display='flex';
    setTimeout(()=>{window.location.href='kids.html';},2000);
  },10000);
});
</script>
</body>
</html>
